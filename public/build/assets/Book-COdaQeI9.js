import{r as o,j as e,a as L,H as z}from"./app-D1eMK3SZ.js";import{S as $,A as B}from"./AuthenticatedLayout-DeM13BqC.js";import{c as D,d as y,g as P,F as R,D as M,f as p,T as w,a as k,C,X as _,t as F,b as q}from"./budget-B78iKhM-.js";import{S as E}from"./save-BTK37BQN.js";import{T as v}from"./trash-2-DRPyXFvi.js";import{c as T}from"./piggy-bank-CvFCs0x6.js";import{U as I}from"./user-pOpDKKC7.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],H=T("calendar",U);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],S=T("circle-x",O);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],J=T("search",X);function K({book:t,canEdit:s}){const[l,i]=o.useState(!1),[r,c]=o.useState(!1),[d,h]=o.useState({name:t.name,description:t.description,budget:t.budget}),b=t.members.find(n=>n.user.id===D.id)?.role||"member",m=y.filter(n=>n.book_id===t.id&&n.status==="approved"&&n.type==="expense").reduce((n,N)=>n+N.amount,0),g=y.filter(n=>n.book_id===t.id&&n.status==="approved"&&n.type==="income").reduce((n,N)=>n+N.amount,0),x=g-m,u=P(m,t.budget),a=n=>{n.preventDefault(),s&&(console.log("Save book settings:",{...d,id:t.id}),i(!1))},j=()=>{b==="creator"&&console.log("Delete book:",t.id)},A=()=>{h({name:t.name,description:t.description,budget:t.budget}),i(!1),c(!1)};return e.jsx("div",{className:"card bg-base-100 shadow-lg",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsx("div",{className:"flex-1",children:l?e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Book Name"})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"input input-bordered w-full pl-10",value:d.name,onChange:n=>h({...d,name:n.target.value}),required:!0}),e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40",size:18})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Description"})}),e.jsx("textarea",{className:"textarea textarea-bordered w-full",value:d.description,onChange:n=>h({...d,description:n.target.value}),rows:2})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text font-medium flex items-center gap-2",children:[e.jsx(M,{size:16}),"Monthly Budget (Optional)"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",placeholder:"Leave empty for no budget limit",className:"input input-bordered w-full pl-10",value:d.budget||"",onChange:n=>h({...d,budget:n.target.value?Number(n.target.value):void 0}),min:0,step:1e3}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-base-content/60",children:"Rp"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",className:"btn btn-primary btn-sm",children:[e.jsx(E,{size:16}),"Save Changes"]}),e.jsx("button",{type:"button",className:"btn btn-ghost btn-sm",onClick:A,children:"Cancel"}),b==="creator"&&e.jsxs("button",{type:"button",className:"btn btn-error btn-sm ml-auto",onClick:()=>c(!0),children:[e.jsx(v,{size:16}),"Delete Book"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-base-content",children:t.name}),e.jsx("p",{className:"text-base-content/70 mt-2",children:t.description})]}),s&&e.jsx("button",{className:"btn btn-ghost btn-sm btn-square",onClick:()=>i(!0),"aria-label":"Edit book",children:e.jsx($,{size:18})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"stat bg-success/10 rounded-lg border border-success/20",children:[e.jsx("div",{className:"stat-title text-success",children:"Total Income"}),e.jsx("div",{className:"stat-value text-success text-2xl",children:p(g)})]}),e.jsxs("div",{className:"stat bg-error/10 rounded-lg border border-error/20",children:[e.jsx("div",{className:"stat-title text-error",children:"Total Expenses"}),e.jsx("div",{className:"stat-value text-error text-2xl",children:p(m)})]}),e.jsxs("div",{className:`stat rounded-lg border ${x>=0?"bg-primary/10 border-primary/20":"bg-warning/10 border-warning/20"}`,children:[e.jsx("div",{className:`stat-title ${x>=0?"text-primary":"text-warning"}`,children:"Net Balance"}),e.jsxs("div",{className:`stat-value text-2xl ${x>=0?"text-primary":"text-warning"}`,children:[x>=0?"+":"-",p(Math.abs(x))]})]})]}),t.budget&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Monthly Budget"}),e.jsx("span",{className:"text-sm font-bold",children:p(t.budget)})]}),e.jsx("progress",{className:`progress w-full ${u>=100?"progress-error":u>=80?"progress-warning":"progress-primary"}`,value:m,max:t.budget,"aria-label":`Budget spent: ${u}%`}),e.jsxs("div",{className:"flex justify-between text-xs text-base-content/60 mt-1",children:[e.jsxs("span",{children:["Spent: ",p(m)]}),e.jsxs("span",{className:u>=100?"text-error font-bold":"",children:[u,"% used"]})]})]})]})})}),r&&e.jsx("div",{className:"mt-4 p-4 bg-error/10 border border-error rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-error mt-1",children:e.jsx(v,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-error",children:"Delete Financial Book"}),e.jsx("p",{className:"text-sm text-base-content/70 mt-1",children:"This action cannot be undone. All transactions and data will be permanently deleted."}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{className:"btn btn-error btn-sm",onClick:j,children:[e.jsx(v,{size:16}),"Yes, Delete Book"]}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>c(!1),children:"Cancel"})]})]})]})})]})})}function f({status:t}){switch(t){case"approved":return e.jsxs("div",{className:"badge badge-success badge-sm gap-1",children:[e.jsx(C,{size:12}),"Approved"]});case"rejected":return e.jsxs("div",{className:"badge badge-error badge-sm gap-1",children:[e.jsx(S,{size:12}),"Rejected"]});case"pending":return e.jsx("div",{className:"badge badge-warning badge-sm",children:"Pending"});default:return e.jsx("div",{className:"badge badge-neutral badge-sm",children:t})}}function Y({book:t}){const[s,l]=o.useState(null),[i,r]=o.useState("all"),[c,d]=o.useState(""),h=t.members.find(a=>a.user.id===D.id)?.role||"member",b=h==="creator"||h==="admin",m=o.useMemo(()=>y.filter(a=>a.book_id===t.id).filter(a=>i==="all"?!0:a.status===i).filter(a=>c?a.description.toLowerCase().includes(c.toLowerCase())||a.category.toLowerCase().includes(c.toLowerCase())||a.user.name.toLowerCase().includes(c.toLowerCase()):!0).sort((a,j)=>new Date(j.created_at).getTime()-new Date(a.created_at).getTime()),[t.id,i,c]),g=a=>new Date(a).toLocaleDateString(),x=a=>{console.log("Approve transaction",a.id)},u=a=>{console.log("Reject transaction",a.id)};return e.jsx("div",{className:"card bg-base-100 shadow",children:e.jsx("div",{className:"card-body",children:s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Transaction Details"}),e.jsx("button",{className:"btn btn-sm btn-circle btn-ghost",onClick:()=>l(null),children:e.jsx(_,{size:18})})]}),e.jsx("div",{className:"card bg-base-200",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full ${s.type==="income"?"bg-success/10 text-success":"bg-error/10 text-error"}`,children:s.type==="income"?e.jsx(w,{size:24}):e.jsx(k,{size:24})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xl font-bold",children:[s.type==="income"?"+":"-",p(s.amount)]}),e.jsx("p",{className:"text-base-content/60",children:s.category})]})]}),e.jsx(f,{status:s.status})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-2",children:"Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:"Description:"}),e.jsx("span",{children:s.description})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:"Date:"}),e.jsx("span",{children:new Date(s.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:"Added by:"}),e.jsx("span",{children:s.user.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:"Created:"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-2",children:"Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:"Status:"}),e.jsx(f,{status:s.status})]}),s.approved_by&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:s.status==="approved"?"Approved by:":"Rejected by:"}),e.jsx("span",{children:s.approved_by.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base-content/60",children:"Last updated:"}),e.jsx("span",{children:new Date(s.updated_at).toLocaleDateString()})]})]})]})]}),s.status==="pending"&&b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{className:"btn btn-success btn-sm flex-1",onClick:()=>x(s),children:[e.jsx(C,{size:16}),"Approve"]}),e.jsxs("button",{className:"btn btn-error btn-sm flex-1",onClick:()=>u(s),children:[e.jsx(S,{size:16}),"Reject"]})]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>l(null),children:"Back to List"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"font-bold text-xl",children:"Transactions"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search transactions...",className:"input input-bordered w-full pl-10",value:c,onChange:a=>d(a.target.value)}),e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40",size:18})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"select select-bordered",value:i,onChange:a=>r(a.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})})]}),e.jsx("div",{className:"space-y-3",children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{size:48,className:"mx-auto text-base-content/30 mb-4"}),e.jsx("p",{className:"text-base-content/60",children:"No transactions found"})]}):m.map(a=>e.jsx("div",{className:"card bg-base-100 border hover:shadow-md transition-shadow cursor-pointer",onClick:()=>l(a),children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${a.type==="income"?"bg-success/10 text-success":"bg-error/10 text-error"}`,children:a.type==="income"?e.jsx(w,{size:20}):e.jsx(k,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-base-content/60",children:[e.jsx("span",{children:a.category}),e.jsx("span",{children:"•"}),e.jsx("span",{children:g(a.date)}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{size:12}),a.user.name]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-bold ${a.type==="income"?"text-success":"text-error"}`,children:[a.type==="income"?"+":"-",p(a.amount)]}),e.jsx(f,{status:a.status})]})]}),a.status==="pending"&&b&&e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{className:"btn btn-success btn-xs",onClick:j=>{j.stopPropagation(),x(a)},children:[e.jsx(C,{size:14}),"Approve"]}),e.jsxs("button",{className:"btn btn-error btn-xs",onClick:j=>{j.stopPropagation(),u(a)},children:[e.jsx(S,{size:14}),"Reject"]})]})]})},a.id))})]})})})}function G({book:t}){const[s,l]=o.useState({type:"expense",category:"",amount:0,description:"",date:new Date().toISOString().split("T")[0]}),i=r=>{r.preventDefault(),console.log("Adding transaction:",{...s,book_id:t.id}),l({type:"expense",category:"",amount:0,description:"",date:new Date().toISOString().split("T")[0]})};return e.jsx("div",{className:"card bg-base-100 shadow",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Tambah Transaksi"}),e.jsxs("form",{onSubmit:i,className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:`btn ${s.type==="income"?"btn-success":"btn-outline"}`,onClick:()=>l({...s,type:"income"}),children:[e.jsx(w,{size:18})," Pemasukan"]}),e.jsxs("button",{type:"button",className:`btn ${s.type==="expense"?"btn-error":"btn-outline"}`,onClick:()=>l({...s,type:"expense"}),children:[e.jsx(k,{size:18})," Pengeluaran"]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Jumlah"})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input input-bordered w-full pl-10",placeholder:"0.00",value:s.amount||"",onChange:r=>l({...s,amount:Number(r.target.value)}),required:!0}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-base-content/60",children:"Rp"})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Kategori"})}),e.jsxs("select",{className:"select select-bordered w-full",value:s.category,onChange:r=>l({...s,category:r.target.value}),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih kategori"}),F.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Tanggal"})}),e.jsx("input",{type:"date",className:"input input-bordered w-full",value:s.date,onChange:r=>l({...s,date:r.target.value}),required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Deskripsi"})}),e.jsx("textarea",{className:"textarea textarea-bordered w-full",placeholder:"Deskripsi singkat...",value:s.description,onChange:r=>l({...s,description:r.target.value}),rows:3,required:!0})]}),e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Review Transaksi"}),e.jsx("p",{children:"Transaksi akan dikirim untuk persetujuan oleh admin buku."})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{type:"submit",className:`btn ${s.type==="income"?"btn-success":"btn-error"} flex-1`,children:["Tambah ",s.type==="income"?"Pemasukan":"Pengeluaran"]})})]})]})})}function te(){const{props:t}=L(),{bookId:s}=t,l=o.useMemo(()=>q.find(c=>c.id===String(s)),[s]);if(!l)return e.jsxs(B,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Book"}),children:[e.jsx(z,{title:"Book"}),e.jsxs("div",{className:"alert alert-error mt-6",children:[e.jsx(_,{}),e.jsx("span",{children:"Book not found."})]})]});const i=l.members.find(c=>c.user.id===D.id)?.role||"member",r=i==="creator"||i==="admin";return e.jsxs(B,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-base-content/90",children:l.name}),e.jsx("div",{className:"badge",children:i==="creator"?"Creator":i==="admin"?"Admin":"Member"})]}),children:[e.jsx(z,{title:`Book • ${l.name}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{book:l,canEdit:r}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Y,{book:l})}),e.jsx("div",{children:e.jsx(G,{book:l})})]})]})]})}export{te as default};
